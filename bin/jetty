#!/bin/bash

# Minimal Jetty start up for Joseki.
# Assumes in the Joseki directory.

if [ "$JOSEKIROOT" = "" ]
then
    echo "JOSEKIROOT not set" 1>&2
    exit 1
    fi

cd "$JOSEKIROOT"

## JETTY_HOME=${JETTY_HOME:-/home/afs/sys/Jetty-4}
JETTY_HOME=${JETTY_HOME:-/home/afs/sys/Jetty-5}

CP2="$(alljars $PWD/lib)"
CP2="$CP2;$(alljars $PWD/lib2)"
CP2="$CP2;$JAVA_HOME/lib/tools.jar"

# Core Jetty - in lib/
# CP2="$CP2;$(alljars $JETTY_HOME/lib)"
# Extra Jetty
CP2="$CP2;$(alljars $JETTY_HOME/ext)"

if [ "$CP" != "" ]
then
    CP2="$CP;$CP2"
else
    CP2="$JOSEKIROOT/classes;$CP2"
    fi

#DEBUG=-DDEBUG=true
FIX=-Dorg.mortbay.util.FileResource.checkAliases=false 

LOGCONFIG=${LOGCONFIG:-file:etc/log4j.properties}
LOGGING="-Dlog4j.configuration=${LOGCONFIG}"

## Run a basic server
CONFIG=etc/jetty.xml

java -cp "$CP2" $LOGGING $DEBUG $FIX org.mortbay.jetty.Server $CONFIG
